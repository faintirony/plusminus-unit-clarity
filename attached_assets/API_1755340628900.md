# –ü–ª—é—Å–ú–∏–Ω—É—Å API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –û–±–∑–æ—Ä

REST API –¥–ª—è SaaS –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —é–Ω–∏—Ç-—ç–∫–æ–Ω–æ–º–∏–∫–∏ —Å–µ–ª–ª–µ—Ä–æ–≤ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤.

**Base URL:** `https://your-domain.com/api`  
**Authentication:** Bearer Token (Supabase JWT)

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Supabase JWT —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ:

```
Authorization: Bearer <supabase_jwt_token>
```

---

## Endpoints

### üîê Authentication

#### POST /api/auth/register
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Request Body:**
```json
{
  "email": "user@example.com",
  "password": "password123",
  "name": "–ò–º—è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "uuid",
      "email": "user@example.com",
      "name": "–ò–º—è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
    },
    "session": {
      "access_token": "jwt_token",
      "refresh_token": "refresh_token"
    }
  }
}
```

#### POST /api/auth/login
–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É

**Request Body:**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

---

### üë§ Users

#### GET /api/users/profile
–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Response:**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "email": "user@example.com",
    "name": "–ò–º—è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
    "isActive": true,
    "createdAt": "2024-01-01T00:00:00Z",
    "updatedAt": "2024-01-01T00:00:00Z"
  }
}
```

#### PUT /api/users/profile
–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å

**Request Body:**
```json
{
  "name": "–ù–æ–≤–æ–µ –ò–º—è"
}
```

#### GET /api/users/metrics
–ü–æ–ª—É—á–∏—Ç—å –æ–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Response:**
```json
{
  "success": true,
  "data": {
    "totalProducts": 150,
    "profitableProducts": 120,
    "unprofitableProducts": 30,
    "avgMarginPercent": 18.5,
    "totalRevenueToday": 45000
  }
}
```

---

### üîë Marketplace Credentials

#### GET /api/credentials
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "marketplace": "wildberries",
      "isValid": true,
      "lastValidatedAt": "2024-01-01T00:00:00Z"
    },
    {
      "id": "uuid",
      "marketplace": "ozon",
      "isValid": false,
      "lastValidatedAt": null
    }
  ]
}
```

#### POST /api/credentials
–î–æ–±–∞–≤–∏—Ç—å API –∫–ª—é—á –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞

**Request Body:**
```json
{
  "marketplace": "wildberries",
  "apiKey": "your_api_key_here"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "marketplace": "wildberries",
    "isValid": true,
    "message": "API –∫–ª—é—á —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω"
  }
}
```

#### DELETE /api/credentials/[id]
–£–¥–∞–ª–∏—Ç—å API –∫–ª—é—á

---

### üì¶ Products

#### GET /api/products
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π

**Query Parameters:**
- `page` (number): –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
- `limit` (number): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50, –º–∞–∫—Å–∏–º—É–º 1000)
- `search` (string): –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ SKU
- `marketplace` (string): –§–∏–ª—å—Ç—Ä –ø–æ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—É (`wildberries`, `ozon`)
- `minMargin` (number): –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –º–∞—Ä–∂–∞ –≤ %
- `maxMargin` (number): –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –º–∞—Ä–∂–∞ –≤ %
- `onlyUnprofitable` (boolean): –¢–æ–ª—å–∫–æ —É–±—ã—Ç–æ—á–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
- `sortBy` (string): –ü–æ–ª–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (`marginPercent`, `name`, `currentPrice`)
- `sortOrder` (string): –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (`asc`, `desc`)

**Example Request:**
```
GET /api/products?search=–∫—Ä–æ—Å—Å–æ–≤–∫–∏&marketplace=wildberries&minMargin=0&sortBy=marginPercent&sortOrder=desc&page=1&limit=50
```

**Response:**
```json
{
  "success": true,
  "data": {
    "products": [
      {
        "id": "uuid",
        "sku": "123456789",
        "name": "–ö—Ä–æ—Å—Å–æ–≤–∫–∏ Nike Air Max",
        "marketplace": "wildberries",
        "currentPrice": 5990,
        "costPrice": 3500,
        "commission": 899,
        "logisticsCost": 200,
        "advertisingCost": 150,
        "marginRub": 1241,
        "marginPercent": 20.72,
        "isProfitable": true,
        "isActive": true,
        "lastSyncedAt": "2024-01-01T00:00:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 50,
      "total": 150,
      "totalPages": 3
    }
  }
}
```

#### GET /api/products/[id]
–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞

**Response:**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "sku": "123456789",
    "name": "–ö—Ä–æ—Å—Å–æ–≤–∫–∏ Nike Air Max",
    "marketplace": "wildberries",
    "currentPrice": 5990,
    "costPrice": 3500,
    "commission": 899,
    "logisticsCost": 200,
    "advertisingCost": 150,
    "marginRub": 1241,
    "marginPercent": 20.72,
    "isProfitable": true,
    "salesHistory": [
      {
        "date": "2024-01-01",
        "revenue": 11980,
        "quantity": 2,
        "returns": 0,
        "adSpend": 300
      }
    ]
  }
}
```

#### PUT /api/products/[id]/cost
–û–±–Ω–æ–≤–∏—Ç—å —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–∞

**Request Body:**
```json
{
  "costPrice": 3200
}
```

#### PUT /api/products/[id]
–û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä

**Request Body:**
```json
{
  "costPrice": 3200,
  "isActive": false
}
```

---

### üîÑ Synchronization

#### POST /api/sync/start
–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö

**Request Body:**
```json
{
  "marketplace": "wildberries" // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ - –≤—Å–µ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ã
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "syncId": "uuid",
    "status": "pending",
    "message": "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞"
  }
}
```

#### GET /api/sync/status/[syncId]
–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**Response:**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "status": "running",
    "marketplace": "wildberries",
    "startedAt": "2024-01-01T00:00:00Z",
    "completedAt": null,
    "productsSynced": 45,
    "totalProducts": 150,
    "progress": 30
  }
}
```

#### GET /api/sync/logs
–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π

**Query Parameters:**
- `page` (number): –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `limit` (number): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
- `marketplace` (string): –§–∏–ª—å—Ç—Ä –ø–æ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—É

**Response:**
```json
{
  "success": true,
  "data": {
    "logs": [
      {
        "id": "uuid",
        "marketplace": "wildberries",
        "status": "completed",
        "startedAt": "2024-01-01T00:00:00Z",
        "completedAt": "2024-01-01T00:05:00Z",
        "productsSynced": 150,
        "errorMessage": null
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 50,
      "totalPages": 3
    }
  }
}
```

---

### üìä Exports

#### POST /api/exports/excel
–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Excel

**Request Body:**
```json
{
  "filters": {
    "search": "–∫—Ä–æ—Å—Å–æ–≤–∫–∏",
    "marketplace": "wildberries",
    "minMargin": 0
  },
  "columns": ["sku", "name", "marginPercent", "currentPrice"],
  "includeHistory": false
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "downloadUrl": "https://temp-storage/export_123.xlsx",
    "expiresAt": "2024-01-01T01:00:00Z"
  }
}
```

---

### üîç Filter Presets

#### GET /api/filters
–ü–æ–ª—É—á–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "name": "–£–±—ã—Ç–æ—á–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã",
      "filters": {
        "onlyUnprofitable": true
      },
      "isDefault": false
    }
  ]
}
```

#### POST /api/filters
–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä

**Request Body:**
```json
{
  "name": "–í—ã—Å–æ–∫–æ–º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–µ",
  "filters": {
    "minMargin": 20
  },
  "isDefault": false
}
```

#### PUT /api/filters/[id]
–û–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä

#### DELETE /api/filters/[id]
–£–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä

---

### üéØ Webhooks (–¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π)

#### POST /api/webhooks/marketplace
Webhook –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤

**Headers:**
```
X-Webhook-Signature: signature
Content-Type: application/json
```

---

## –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤

- `200` - –£—Å–ø–µ—à–Ω–æ
- `201` - –°–æ–∑–¥–∞–Ω–æ
- `400` - –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `401` - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `403` - –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω
- `404` - –ù–µ –Ω–∞–π–¥–µ–Ω–æ
- `429` - –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
- `500` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

## –§–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏",
    "details": {
      "field": "email",
      "issue": "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email"
    }
  }
}
```

## Rate Limiting

- **–û–±—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã:** 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:** 1 –∑–∞–ø—Ä–æ—Å –≤ 5 –º–∏–Ω—É—Ç –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–≠–∫—Å–ø–æ—Ä—Ç:** 5 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —á–∞—Å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## Webhooks Events

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å webhooks:

- `product.margin_changed` - –ò–∑–º–µ–Ω–∏–ª–∞—Å—å –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–∞
- `sync.completed` - –ó–∞–≤–µ—Ä—à–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- `sync.failed` - –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏